@using Microsoft.AspNetCore.Components.Forms
@using System.Text.Json
@using System.Net.Http.Headers
@using global::Shared.Entities
@inject IStringLocalizer<ApplicationResource> _localizer
@inject HttpClient Client

<EditForm Model=@Model OnValidSubmit=@_validFormSubmitted OnInvalidSubmit=@_invalidFormSubmitted>
    <DataAnnotationsValidator />
    @FormFields
    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto d-flex" justify-end>@SaveButton</MudButton>
</EditForm>

@code {
    [Inject] 
    ISnackbar Snackbar { get; set; }
    [Parameter]
    public RenderFragment FormFields { get; set; }
    [Parameter]
    public object Model { get; set; }
    [Parameter]
    public object SaveButton { get; set; }

    public string modelName;

    protected override void OnInitialized()
    {
        modelName = Model.GetType().Name;
        base.OnInitialized();
    }

    private async void _validFormSubmitted(EditContext context)
    {
        await _post();
        Snackbar.Add(Model.GetType().Name + " toegevoegd!", Severity.Success);
        StateHasChanged();
    }

    private void _invalidFormSubmitted(EditContext context)
    {
        Snackbar.Add("Er is iets fout gegaan", Severity.Error);
        StateHasChanged();
    }

    private async Task _post()
    {
        await Client.PostAsJsonAsync((Model.GetType().Name + 's').ToLower(), Model);
    }
}